/*! klayjs-d3 - v0.1.0 - 2014-07-16
 */
var klay=function(){"use strict";var a,b={intCoordinates:!0,algorithm:"de.cau.cs.kieler.klay.layered",layoutHierarchy:!0,spacing:20,borderSpacing:20,edgeSpacingFactor:.2,inLayerSpacingFactor:2,nodePlace:"BRANDES_KOEPF",nodeLayering:"NETWORK_SIMPLEX",edgeRouting:"POLYLINE",crossMin:"LAYER_SWEEP",direction:"RIGHT"},c=function(a){for(var b=0;b<a.length;b++)(null===a[b]||void 0===a[b])&&(a.splice(b,1),b--);return a};return{init:function(b){var c,d;return c="onSuccess"in b?b.onSuccess:console.log,d="workerScript"in b?b.workerScript:"klay-worker.js",a=new Worker(d),a.addEventListener("message",function(a){c(a.data)},!1),this},layout:function(c){var d,e,f,g,h;"graph"in c&&(d=c.graph,e="options"in c?c.options:b,g="direction"in c?c.direction:"RIGHT","portInfo"in c?(f=c.portInfo,h=this.nofloToKieler(d,f,g)):h=d,a.postMessage({graph:h,options:e}))},nofloToKieler:function(a,b,d){d=d||"RIGHT";var e="FIXED_POS",f={inportSide:"WEST",outportSide:"EAST",width:10,height:10};"DOWN"===d&&(f.inportSide="NORTH",f.outportSide="SOUTH");var g={width:72,height:72},h={id:a.name,children:[],edges:[]},i=a.nodes,j={},k=0,l=i.map(function(a){var c=b[a.id].inports,d=Object.keys(c),h=d.map(function(c){return{id:a.id+"_"+c,width:f.width,height:f.height,x:b[a.id].inports[c].x-f.width,y:b[a.id].inports[c].y}}),i=b[a.id].outports,l=Object.keys(i),m=l.map(function(c){return{id:a.id+"_"+c,width:f.width,height:f.height,x:b[a.id].outports[c].x,y:b[a.id].outports[c].y}}),n={id:a.id,labels:[{text:a.metadata.label}],width:g.width,height:g.height,ports:h.concat(m),properties:{portConstraints:e}};return j[a.id]=k++,n}),m=a.inports,n=Object.keys(m),o=n.map(function(a){var b=m[a],c="inport:::"+a,d={id:b.port,width:f.width,height:f.height,properties:{"de.cau.cs.kieler.portSide":f.outportSide}},h={id:c,labels:[{text:a}],width:g.width,height:g.height,ports:[d],properties:{portConstraints:e,"de.cau.cs.kieler.klay.layered.layerConstraint":"FIRST_SEPARATE"}};return j[c]=k++,h}),p=a.outports,q=Object.keys(p),r=q.map(function(a){var b=p[a],c="outport:::"+a,d={id:b.port,width:f.width,height:f.height,properties:{"de.cau.cs.kieler.portSide":f.inportSide}},h={id:c,labels:[{text:a}],width:g.width,height:g.height,ports:[d],properties:{portConstraints:e,"de.cau.cs.kieler.klay.layered.layerConstraint":"LAST_SEPARATE"}};return j[c]=k++,h});h.children=l.concat(o,r);var s=0,t=a.edges;t.map(function(a){if(void 0===a.data){var b=a.from.node,c=a.from.port,d=a.to.node,e=a.to.port;h.edges.push({id:"e"+s++,source:b,sourcePort:b+"_"+c,target:d,targetPort:d+"_"+e})}});var u=n.map(function(a){var b=m[a],c="inport:::"+a,d=a,e=b.process,f=b.port,g={id:"e"+s++,source:c,sourcePort:c+"_"+d,target:e,targetPort:e+"_"+f};return g}),v=q.map(function(a){var b=p[a],c=b.process,d=b.port,e="outport:::"+a,f=a,g={id:"e"+s++,source:c,sourcePort:c+"_"+d,target:e,targetPort:e+"_"+f};return g});h.edges=h.edges.concat(u,v);var w=a.groups,x=0,y=[];return w.map(function(a){var b={id:"group"+x++,children:[],edges:[]};a.nodes.map(function(a){var d=h.children[j[a]];null!==d&&(y.indexOf(d)>=0||(y.push(d),b.children.push(d),b.edges.push(h.edges.filter(function(b){return!b||b.source!==a&&b.target!==a?void 0:b})[0]),b.edges=c(b.edges),h.children[j[a]]=null))}),b.edges.map(function(a){a&&(h.edges[parseInt(a.id.substr(1),10)]=null)}),h.children.push(b)}),h.children=c(h.children),h.edges=c(h.edges),h}}}(),klay;!function(a){function b(b){function d(a){var b=n/a.width||1,c=o/a.height||1;b>c&&(b=c),e&&e.attr("transform","scale("+b+")")}var e,f={},g=d3.dispatch("finish"),h=[],i=[],j={},k=function(a){return a.ports||[]},l=function(a){return a.labels||[]},m={},n=0,o=0,p=[10,10],q=[4,4],r=["x","y","width","height","sourcePoint","targetPoint","properties"].reduce(function(a,b){return a[b]=1,a},{}),s=function(){},t=a.init({onSuccess:function(a){a.id?(j=a,s(a)):console.log(a)},workerScript:c+"/klayjs-worker.js"});if(f.size=function(a){return arguments.length?(n=a[0],o=a[1],f):[n,o]},f.transformGroup=function(a){return arguments.length?(e=a,f):e},f.options=function(a){return arguments.length?(m=a,f):m},"adapter"===b){f.nodes=function(a){return arguments.length?(h=a,f):h},f.ports=function(a){return arguments.length?(k=a,f):k},f.links=function(a){return arguments.length?(i=a,f):i},f.defaultNodeSize=function(a){return arguments.length?(p=a,f):p},f.defaultPortSize=function(a){return arguments.length?(q=a,f):q},f.start=function(){return h.forEach(function(a,b){a.width=a.width||p[0],a.height=a.height||p[1],a.id=""+(a.id||b),a.ports=k(a),a.ports.forEach(function(a){a.width=a.width||q[0],a.height=a.height||q[1]}),a.labels=l(a)}),i.forEach(function(a,b){a.id=""+(a.id||b+h.length),a.source=""+a.source,a.target=""+a.target}),s=u,t.layout({graph:{id:"root",children:h,edges:i},options:m}),f};var u=function(a){function b(a,b,c){var d=r;c&&(d=c.reduce(function(a,b){return a[b]=1,a},{}));for(var e in a)d[e]&&(b[e]=a[e])}a&&(d(a),a.children.forEach(function(a){var c=h[parseInt(a.id)];b(a,c),(a.ports||[]).forEach(function(a,d){b(a,c.ports[d])}),(a.labels||[]).forEach(function(a,d){b(a,c.labels[d])})}),a.edges.forEach(function(a){var c=i[parseInt(a.id)-h.length];b(a,c),b(a.source,c.source),b(a.target,c.target),c.bendPoints=a.bendPoints||[]})),g.finish({graph:a})}}if("kgraph"===b){f.nodes=function(){for(var a,b=[j],c=[];null!=(a=b.pop());)c.push(a),(a.children||[]).forEach(function(a){b.push(a)});return c},f.links=function(a){return d3.merge(a.map(function(a){return a.edges||[]}))},f.kgraph=function(a){return s=v,t.layout({graph:a,options:m}),f};var v=function(a){d(a);var b={};w(a,{x:0,y:0},b),x(a,b),g.finish({graph:a})},w=function(a,b,c){a.x=(a.x||0)+b.x,a.y=(a.y||0)+b.y,c[a.id]=a,(a.children||[]).forEach(function(b){b.parent=a,w(b,{x:a.x,y:a.y},c)})},x=function(a,b){(a.edges||[]).forEach(function(a){var c=b[a.source].parent||{};a.sourcePoint&&(a.sourcePoint.x+=c.x||0,a.sourcePoint.y+=c.y||0),a.targetPoint&&(a.targetPoint.x+=c.x||0,a.targetPoint.y+=c.y||0),(a.bendPoints||[]).map(function(a){return{x:a.x+(c.x||0),y:a.y+(c.y||0)}})}),(a.children||[]).forEach(function(a){x(a,b)})}}return d3.rebind(f,g,"on")}if("function"!=typeof window.Worker)return window.alert("WebWorker not supported by browser."),{};a.d3adapter=function(){return b("adapter")},a.d3kgraph=function(){return b("kgraph")};var c=function(){var a=document.getElementsByTagName("script");a=a[a.length-1];var b=a.src,c=b.substr(0,b.lastIndexOf("/")+1);return c}();return a}(klay||(klay={}));